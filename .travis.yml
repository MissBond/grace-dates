language: node_js
node_js:
  - node # uses most recent stable node version
services:
  - postgresql # starts up postgres
addons:
  postgresql: '9.6' # highest available postgres version on Travis
dist: trusty # uses trusty environment
sudo: false # when on trusty, uses Docker containers for speed
notifications:
  email:
    on_success: change # default: change (only when going from broken to fixed)
    on_failure: always # default: always (which is annoying, as it should be)
install:
  - npm ci # faster, goes only from package-lock
before_script:
  - psql -c 'create database "grace-dates-test";' -U postgres # remember to change this name if you change it elsewhere (e.g. package.json)

before_deploy:
  - npm run build-client # make the bundle
  - rm -rf node_modules # omit from the tarball, since we skip cleanup
deploy:
  skip_cleanup: true # prevents travis from deleting the build
  provider: heroku
  app: grace-dates # see README
  api_key:
    secure: OU61uOqOaZxl3ZpJ4cz6yyJnXGuPOs1C0zkYRjuPmiGr+7p+CNJCGI2F/Pan+BSqGp/33dlFucjP
    secure: uzpNSsub9h51sdo+y8L/GjLA5QvhzGMGRU2/mjqBLTqqLKtee2ync0TU+37bXWw+V0qp7v4+Rmb1
    secure: U6WCZ+QxN0TdO2pMpaxX9LZaPipDKAvCCTwJuFwsm2czb0gw2Xfv/4tio4WV7/zwGnFrb4nwehh4
    secure: lebHk8KysUBBaPUmEDfaxRC5bdQDRVN9XokKnfK1MhNVwNcaC8aMUdTClzs+gRg6Ry8wK/dzkJqp
    secure: N/WQx0AhX4GYIgBgeLPYW9f3i103b0nLPmnROAivPSfFYzGkt5zbqe019A84bMh+D8uDw2bqAcvt
    secure: yhRnH6K/ye5CZSHLudJmqiXqNPbSY6a/3bZTF11jBTpkzyx7RX/K94AcB9LweoKGxF1gteX01RAo
    secure: buhwAUptVAMmMIlgEIW3fTnHnDAhAXOpfove7zbCev4YUv8r++oQb0YRSN4LrUOfFtAw8lv6lFFe
    secure: Qu9L7dYbVfRtwTd19I8OsAy7w7npcACznOBCm0m3pRznp6bPyFb9cBX9tV0M6X9ETclkX/UuxbX+
    secure: A8YzF6QhhSypsO627hUgxOryRb3ygiik/KjGCJoKhHog8NCGITzKYqExFy4+STBaMmXDtuWW28s=